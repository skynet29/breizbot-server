
# Webapp development principles

The webapp development is based on 2 main ideas:
- **components** (thereafter we use rather the word **control**)
- **services**

A control may need one or severals services to work which themselves may need over services to work.

![controls&services](https://user-images.githubusercontent.com/27694866/42309800-f384a64c-8039-11e8-9b7a-fb222c886928.png)

## Controls

Controls are javascript code whose goal is to manage a part of the HTML DOM. A control can be instantiated as many times as you want in your webapp (WEB page).

In theory a webapp should consist of one main control which itself consists of one or severals controls.

Example of the system webapp users break down:

![mainctrl](https://user-images.githubusercontent.com/27694866/42309859-2928e10a-803a-11e8-825a-0fa97223f5c5.png)

For now, the HeaderControl is part of the webapp skeleton generated by the server so you don't need to worry about it.

## Services

Services are javascript object which are instanciated automatically by the framework when first needed.

Services may be configured at webapp startup in the **configReady** function before any controls creation.

## A word about files tree

the sources of the front-end are located in the **src** directory.
The **dist** folder is the result of the build which is based on **GULP** task runner.

The sources of the Webapp are located in the **src/pages** directory.

The sources of the common controls libraries are located in the **src/controls** directory.

The sources of the common services library are located in the **src/services** directory.


# Create a new Webapp

To create a new Webapp, first create a new folder **helloWorldApp** in the **src/pages** directory.

In this directory, create a new javascript file (the name does not matter) with the following code:
````javascript
$$.configReady(function(config) {
  /* setup your services here if needed
  $$.configureService('MyService', {...})
  */
  
  // start your main control here
  $$.startApp('MainControl')
})
````

The only argument of the **configReady** function is a callback function which is called by the framework when the configuration of the webapp has been retrieved. The configuration point will be addressed later.

Then create two others files for the MainControl:
- a javascript one: **main.js** which will contain the view controler code
- a HTML fragment: **main.html**

## main.js
````javascript
$$.registerControl('MainControl', function(elt) {
  const ctrl = $$.viewController(elt, {
    template: {gulp_inject: './main.html'},
    data: {
      title: 'Hello World'
     }
  })
})
````

## main.html
````html
<h1 bn-text="title"></h1>
````

Note: create a main control is not an obligation but is needed if you have to configure services.

As you can see, the HTML fragment will be injected in the **template** field as a string by the build system.

To finish, start a terminal window and launch the build system:

````shell
gulp watch
````

In the **dist** folder, a **helloWorldApp** directory has been created with only one file **app.js** which is the concatenation of all your javascript files.

Note: the command **gulp watch** must be restarted each time you create a new file but not if you only edit existing files.

To publish your webapp in the system, you have to tape the following command in a terminal window:
````shell
node install
````
This command regenerate the **webapps.json** file located in the **config** directory. This file is used by the server to manage the webapps.

To view your new webapp in your webapps panel, you have to ask your system administrator to add the webapp to your user account. If you are the admin, launch the users webapp to associate the new webapp to user account.

